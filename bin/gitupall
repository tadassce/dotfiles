#! /usr/bin/env ruby

def emoji
  case `git remote -v`
  when /github/ then '🐙'
  when /gitlab/ then '😸'
  else               '🤖'
  end
end

home = Dir.pwd

Dir['*']
  .select { |d| File.exist?("#{d}/.git") }
  .each do |dir|

  Dir.chdir dir

  name = dir.split('/').last
  puts "\n#{emoji} Updating #{name}"

  system 'git fetch --all'

  current_branch = `git symbolic-ref HEAD | sed 's#^refs/heads/##'`.strip
  if %w{ master dev }.include? current_branch
    system "git rebase origin/#{current_branch}"
  end

  Dir.chdir home
end
