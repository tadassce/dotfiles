#!/bin/bash

# Install script for a fresh macOS install.
# Meant for copy-pasting rather than just running so far.

# - Install 1P and XCode from the MAS

xcode-select --install

# Install Homebrew
/usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
brew analytics off

brew install \
  mas \
  vim \
  git \
  zsh \
  tmux \
  ctags \
  the_silver_searcher \
  fzf \
  htop \
  reattach-to-user-namespace \
  openssh \
  heroku/brew/heroku \
  node \
  watch

# To install useful key bindings and fuzzy completion:
$(brew --prefix)/opt/fzf/install

# Homebrew Cask
brew tap caskroom/cask
brew cask install \
  dropbox \
  alfred \
  docker \
  appcleaner \
  karabiner-elements

# Wait for Dropbox to sync

# Set up dotfiles
brew tap thoughtbot/formulae
brew install rcm
git clone https://github.com/tadassce/dotfiles.git ~/.dotfiles
rcup

# Set the default shell (and in Users' prefs)
chsh -s /usr/local/bin/zsh

# Vim Plugins
curl -fLo ~/.vim/autoload/plug.vim --create-dirs \
  https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim
# :PlugInstall

# Vim undo (gitignored)
mkdir ~/.vim/undo

# Tmux Plugin Manager
git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm

# Set some macOS defaults
#
# Disable the warning when changing a file extension
defaults write com.apple.finder FXEnableExtensionChangeWarning -bool false
# Check for software updates daily, not just once per week
defaults write com.apple.SoftwareUpdate ScheduleFrequency -int 1
# Empty Trash securely by default
defaults write com.apple.finder EmptyTrashSecurely -bool false
# Automatically hide and show the Dock
defaults write com.apple.dock autohide -bool true
# Screenshots
defaults write com.apple.screencapture disable-shadow -bool true
defaults write com.apple.screencapture location ~/Dropbox/Screenshots
# Kill affected applications
for app in Finder Mail Dock SystemUIServer; do killall "$$app" >/dev/null 2>&1; done

# Tools I always want to have
gem install pry pry-doc
npm i -g tldr

# Linters
gem install \
  reek \
  rubocop \
  ruby-lint \
  coderay \
  brakeman \
  rails_best_practices
brew install \
  shellcheck \
  hadolint
npm i -g \
  eslint-plugin-react \
  eslint@^4.1.1 \
  eslint-plugin-jsx-a11y@^5.1.1 \
  babel-eslint@^7.2.3 \
  eslint-config-react-app \
  eslint-plugin-import \
  eslint-plugin-flowtype \
  jshint \
  jsonlint \
  prettier \
  swaglint

# Some useful Quick Look plugins
brew cask install \
  qlstephen \
  qlmarkdown \
  quicklook-json \
  quicklook-csv \
  qlcolorcode \
  qlimagesize

# Sync Karabiner settings (make sure Dropbox sync is done)
ln -s ~/Dropbox/Apps/karabiner ~/.config/
launchctl kickstart -k gui/`id -u`/org.pqrs.karabiner.karabiner_console_user_server
